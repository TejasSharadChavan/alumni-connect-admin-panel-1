<!doctype html>
<html>
  <head>
    <title>Debug Jobs API</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .result {
        background: #f5f5f5;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .error {
        background: #ffe6e6;
        border: 1px solid #ff9999;
      }
      .success {
        background: #e6ffe6;
        border: 1px solid #99ff99;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
      }
      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Debug Jobs API</h1>

      <div>
        <button onclick="testLogin()">1. Test Login</button>
        <button onclick="seedData()">2. Seed Data</button>
        <button onclick="listJobs()">3. List Jobs</button>
        <button onclick="testJobDetails()">4. Test Job Details</button>
      </div>

      <div id="results"></div>
    </div>

    <script>
      let authToken = null;

      function addResult(title, content, isError = false) {
        const results = document.getElementById("results");
        const div = document.createElement("div");
        div.className = `result ${isError ? "error" : "success"}`;
        div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
        results.appendChild(div);
      }

      async function testLogin() {
        try {
          const response = await fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email: "rahul.agarwal@gmail.com",
              password: "Password@123",
            }),
          });

          const data = await response.json();
          if (data.success) {
            authToken = data.token;
            addResult(
              "Login Test",
              `✅ Success! Token: ${authToken.substring(0, 20)}...`
            );
          } else {
            addResult("Login Test", `❌ Failed: ${JSON.stringify(data)}`, true);
          }
        } catch (error) {
          addResult("Login Test", `❌ Error: ${error.message}`, true);
        }
      }

      async function seedData() {
        try {
          const response = await fetch("/api/seed", {
            method: "POST",
          });

          const data = await response.json();
          addResult(
            "Seed Data",
            `✅ Response: ${JSON.stringify(data, null, 2)}`
          );
        } catch (error) {
          addResult("Seed Data", `❌ Error: ${error.message}`, true);
        }
      }

      async function listJobs() {
        if (!authToken) {
          addResult("List Jobs", "❌ Please login first", true);
          return;
        }

        try {
          const response = await fetch("/api/jobs", {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          const data = await response.json();
          addResult(
            "List Jobs",
            `✅ Jobs found: ${JSON.stringify(data, null, 2)}`
          );
        } catch (error) {
          addResult("List Jobs", `❌ Error: ${error.message}`, true);
        }
      }

      async function testJobDetails() {
        if (!authToken) {
          addResult("Job Details", "❌ Please login first", true);
          return;
        }

        try {
          const response = await fetch("/api/jobs/1", {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          const data = await response.json();
          addResult(
            "Job Details",
            `Response: ${JSON.stringify(data, null, 2)}`,
            !response.ok
          );
        } catch (error) {
          addResult("Job Details", `❌ Error: ${error.message}`, true);
        }
      }
    </script>
  </body>
</html>
